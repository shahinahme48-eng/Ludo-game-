<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Master Admin Pro</title>
<script src="https://cdn.tailwindcss.com"></script>

<style>
body {background:#0f172a;color:white;font-family:'Inter',sans-serif;}
.card {
    border-radius:1.5rem;
    padding:1.5rem;
    margin-bottom:1.5rem;
    box-shadow:0 8px 20px rgba(0,0,0,0.6);
    transition: transform 0.3s, box-shadow 0.3s;
}
.card:hover {
    transform: translateY(-3px);
    box-shadow:0 12px 25px rgba(0,0,0,0.7);
}
.input-field {
    background:#1e293b;
    padding:0.75rem;
    border-radius:0.75rem;
    border:1px solid #334155;
    color:white;
    outline:none;
    width:100%;
    transition:0.3s;
}
.input-field:focus {
    border-color:#3b82f6;
    box-shadow:0 0 0 2px rgba(59,130,246,0.5);
}
.btn {
    padding:0.75rem 1rem;
    border-radius:0.75rem;
    font-weight:bold;
    text-transform:uppercase;
    transition:0.3s;
    cursor:pointer;
}
.btn-yellow {
    background:linear-gradient(90deg,#facc15,#fbbf24);
    color:#000;
}
.btn-yellow:hover {
    background:linear-gradient(90deg,#f59e0b,#d97706);
}
.btn-cyan {
    background:linear-gradient(90deg,#06b6d4,#0ea5e9);
    color:#000;
}
.btn-cyan:hover {
    background:linear-gradient(90deg,#0e7490,#0284c7);
}
.toast {
    position:fixed;
    top:1rem;
    right:1rem;
    background:#334155;
    padding:1rem 1.5rem;
    border-radius:1rem;
    font-size:0.8rem;
    font-weight:bold;
    opacity:0;
    transform:translateY(-20px);
    transition:0.3s;
    z-index:1000;
}
.toast.show {
    opacity:1;
    transform:translateY(0);
}
.badge {
    padding:0.25rem 0.5rem;
    border-radius:0.5rem;
    font-size:9px;
    font-weight:bold;
}
.badge-approve {background:linear-gradient(90deg,#16a34a,#22c55e);}
.badge-reject {background:linear-gradient(90deg,#dc2626,#ef4444);}
</style>
</head>

<body class="p-4">

<!-- Toast -->
<div id="toast" class="toast"></div>

<!-- LOGIN PAGE -->
<div id="login-page" class="max-w-sm m-auto mt-20">
    <h1 class="text-3xl font-extrabold text-center text-blue-500 mb-8 uppercase italic">
        Admin Login
    </h1>
    <div class="card bg-gradient-to-r from-slate-800 to-slate-900">
        <input type="password" id="password"
               placeholder="Enter Admin Password"
               class="input-field mb-6 text-center tracking-widest">
        <button onclick="login()" class="btn btn-yellow w-full">
            Login
        </button>
    </div>
</div>

<!-- MAIN ADMIN PANEL -->
<div id="main" class="hidden max-w-4xl m-auto">

    <div class="flex justify-between items-center mb-6">
        <h1 class="text-3xl font-extrabold text-blue-500 uppercase italic">
            Master Control
        </h1>
        <button onclick="logout()" class="btn btn-cyan">Logout</button>
    </div>

    <!-- Host Match -->
    <div class="card bg-gradient-to-r from-yellow-400 to-yellow-300">
        <h3 class="text-sm font-bold text-black mb-4 uppercase">üèÜ Host Tournament</h3>
        <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 mb-4">
            <input type="number" id="fee" placeholder="Entry Fee" class="input-field">
            <input type="number" id="prize" placeholder="Prize Pool" class="input-field">
            <select id="mode" class="input-field">
                <option value="2">2 Player</option>
                <option value="4">4 Player</option>
            </select>
            <input type="text" id="time" placeholder="Time (8:40 PM)" class="input-field">
        </div>
        <button onclick="create()" class="btn btn-yellow w-full">
            Publish Match
        </button>
    </div>

    <!-- Pending Requests -->
    <div class="card bg-gradient-to-r from-pink-500 to-pink-400">
        <h3 class="text-sm font-bold text-black mb-4 uppercase">üìù Pending Requests</h3>
        <div id="req-list" class="space-y-3 text-xs"></div>
    </div>

    <!-- Active Matches -->
    <div class="card bg-gradient-to-r from-blue-500 to-blue-400">
        <h3 class="text-sm font-bold text-black mb-4 uppercase">üéÆ Manage Lobby</h3>
        <div id="active-matches" class="space-y-2"></div>
    </div>

    <!-- Users -->
    <div class="card bg-gradient-to-r from-green-500 to-green-400">
        <h3 class="text-sm font-bold text-black mb-4 uppercase">üë• Users</h3>
        <div class="max-h-44 overflow-y-auto text-[11px]">
            <table class="w-full">
                <thead class="text-[10px] uppercase">
                    <tr>
                        <th>User ID</th>
                        <th>Balance</th>
                    </tr>
                </thead>
                <tbody id="user-table"></tbody>
            </table>
        </div>
    </div>

    <!-- Settings -->
    <div class="card bg-gradient-to-r from-cyan-500 to-cyan-400">
        <h3 class="text-sm font-bold text-black mb-4 uppercase">‚öôÔ∏è Settings</h3>
        <input type="text" id="bik" placeholder="bKash" class="input-field mb-2">
        <input type="text" id="wa" placeholder="WhatsApp" class="input-field mb-2">
        <input type="number" id="bonus" placeholder="Refer Bonus" class="input-field mb-4">
        <button onclick="update()" class="btn btn-cyan w-full">
            Save Settings
        </button>
    </div>
</div>

<script>
/* ================= CONFIG ================= */
const ADMIN_PASSWORD = "12341234"; // üîê Admin Password
const R_URL = "https://ludo-pro-engine.onrender.com";
/* ========================================= */

function showToast(msg){
    const t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(()=>t.classList.remove("show"),2000);
}

function login(){
    const pass = document.getElementById("password").value;
    if(pass === ADMIN_PASSWORD){
        document.getElementById("login-page").classList.add("hidden");
        document.getElementById("main").classList.remove("hidden");
        showToast("‚úÖ Admin Access Granted");
        load();
    } else {
        showToast("‚ùå Wrong Password");
    }
}

function logout(){
    document.getElementById("main").classList.add("hidden");
    document.getElementById("login-page").classList.remove("hidden");
    document.getElementById("password").value="";
    showToast("üîí Logged Out");
}

/* ===== API FUNCTIONS ===== */
async function load(){
    const r = await fetch(`${R_URL}/api/admin/requests`);
    const data = await r.json();
    document.getElementById("req-list").innerHTML = data.map(x=>`
        <div class="bg-slate-900 p-3 rounded-xl flex justify-between">
            <div>
                <p class="font-bold">${x.type}</p>
                <p>‡ß≥${x.amount}</p>
                <p class="text-[9px] text-gray-400">${x.userId}</p>
            </div>
            <div class="flex flex-col gap-1">
                <span class="badge badge-approve" onclick="handle('${x._id}','approve')">Approve</span>
                <span class="badge badge-reject" onclick="handle('${x._id}','reject')">Reject</span>
            </div>
        </div>
    `).join("");

    const m = await fetch(`${R_URL}/api/getMatches`).then(r=>r.json());
    document.getElementById("active-matches").innerHTML = m.map(x=>`
        <div class="bg-slate-900 p-2 rounded flex justify-between">
            <span>‡ß≥${x.prize} - ${x.startTime}</span>
            <button onclick="delMatch('${x._id}')" class="text-red-400 text-xs">DELETE</button>
        </div>
    `).join("");

    const u = await fetch(`${R_URL}/api/admin/users`).then(r=>r.json());
    document.getElementById("user-table").innerHTML = u.map(x=>`
        <tr><td>${x.userId}</td><td>‡ß≥${x.balance}</td></tr>
    `).join("");

    const s = await fetch(`${R_URL}/api/settings`).then(r=>r.json());
    bik.value=s.bikash||""; wa.value=s.wa||""; bonus.value=s.referBonus||10;
}

async function handle(id,action){
    await fetch(`${R_URL}/api/admin/handleRequest`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({id,action})
    });
    showToast("Done");
    load();
}
async function delMatch(id){
    await fetch(`${R_URL}/api/admin/deleteMatch`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({id})
    });
    showToast("Deleted");
    load();
}
async function create(){
    await fetch(`${R_URL}/api/createMatch`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            entryFee:fee.value,
            prize:prize.value,
            mode:mode.value,
            startTime:time.value
        })
    });
    showToast("Match Live");
    load();
}
async function update(){
    await fetch(`${R_URL}/api/updateSettings`,{
        method:"POST",
        headers:{"Content-Type":"application/json"},
        body:JSON.stringify({
            bikash:bik.value,
            wa:wa.value,
            referBonus:bonus.value
        })
    });
    showToast("Saved");
}
</script>

</body>
</html>
