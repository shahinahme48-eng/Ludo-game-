<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ludo Cash Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --red: #ff4d4d; --green: #2ecc71; --yellow: #f1c40f; --blue: #3498db; }
        #ludo-board { display: grid; grid-template-columns: repeat(15, 1fr); width: 95vw; height: 95vw; max-width: 400px; max-height: 400px; border: 4px solid #333; margin: auto; }
        .cell { border: 1px solid #eee; background: white; }
        .red { background-color: var(--red); } .green { background-color: var(--green); }
        .yellow { background-color: var(--yellow); } .blue { background-color: var(--blue); }
        .tab-content { display: none; } .active-tab { display: block; }
    </style>
</head>
<body class="bg-gray-100 pb-20">
    <div class="bg-blue-700 text-white p-4 flex justify-between shadow-lg">
        <h1 class="font-bold uppercase tracking-wider">Ludo Win</h1>
        <div class="text-right"><p class="text-xs">Wallet</p><p class="font-bold text-yellow-400">à§³ <span id="balance">0</span></p></div>
    </div>

    <!-- GAME -->
    <div id="game-tab" class="tab-content active-tab p-4 text-center">
        <div id="ludo-board" class="shadow-xl bg-white mb-6"></div>
        <button onclick="rollDice()" class="bg-blue-600 text-white px-10 py-3 rounded-lg font-bold text-2xl shadow-lg">ðŸŽ² <span id="dice-val">?</span></button>
    </div>

    <!-- WALLET -->
    <div id="wallet-tab" class="tab-content p-4">
        <div class="bg-white p-5 rounded-xl shadow">
            <h2 class="font-bold mb-4 text-center">Deposit Cash</h2>
            <div class="bg-pink-100 p-4 rounded mb-4 font-bold text-center text-pink-700 border border-pink-300">
                SEND MONEY (bKash): <br> 017XXXXXXXX
            </div>
            <input type="number" id="dep-amount" placeholder="Enter Amount (à§³)" class="w-full border p-3 rounded mb-2">
            <input type="text" id="dep-trx" placeholder="Transaction ID (TrxID)" class="w-full border p-3 rounded mb-4">
            <button onclick="submitDeposit()" class="w-full bg-pink-600 text-white py-3 rounded font-bold hover:bg-pink-700 transition">Submit Request</button>
        </div>
    </div>

    <!-- ADMIN -->
    <div id="admin-tab" class="tab-content p-4">
        <h2 class="font-bold mb-4 text-red-600 text-center uppercase">Admin Approval</h2>
        <div id="admin-list" class="space-y-3"></div>
    </div>

    <!-- NAVIGATION -->
    <div class="fixed bottom-0 w-full bg-white border-t flex justify-around p-4 shadow-2xl z-50">
        <button onclick="showTab('game-tab')" class="font-bold text-blue-600">PLAY</button>
        <button onclick="showTab('wallet-tab')" class="font-bold text-gray-500">WALLET</button>
        <button onclick="showTab('admin-tab')" class="font-bold text-gray-400 text-xs">ADMIN</button>
    </div>

    <script>
        const userId = "shahin_1"; // Permanent ID for this player
        
        async function loadBalance() {
            const res = await fetch(`/api/wallet?userId=${userId}`);
            const data = await res.json();
            document.getElementById('balance').innerText = data.balance || 0;
        }

        async function submitDeposit() {
            const amount = document.getElementById('dep-amount').value;
            const trxId = document.getElementById('dep-trx').value;
            if(!amount || !trxId) return alert("Fill all info!");
            
            await fetch('/api/wallet', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type: 'deposit', userId, amount, trxId })
            });
            alert("Sent! Wait for admin approval.");
            document.getElementById('dep-amount').value = '';
            document.getElementById('dep-trx').value = '';
        }

        async function loadAdmin() {
            const res = await fetch('/api/wallet?admin=true');
            const list = await res.json();
            const div = document.getElementById('admin-list');
            if(list.length === 0) div.innerHTML = "<p class='text-center text-gray-400'>No pending requests</p>";
            else {
                div.innerHTML = list.map(r => `
                    <div class="bg-white p-3 shadow rounded flex justify-between items-center border-l-4 border-green-500">
                        <div><p class="font-bold">à§³${r.amount}</p><p class="text-xs text-gray-500">${r.trxId}</p></div>
                        <button onclick="approve('${r._id}', '${r.userId}', ${r.amount})" class="bg-green-600 text-white px-3 py-1 rounded text-sm">Approve</button>
                    </div>
                `).join('');
            }
        }

        async function approve(id, uId, amt) {
            await fetch('/api/wallet', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type: 'approve', id, userId: uId, amount: amt })
            });
            loadAdmin(); loadBalance();
        }

        function showTab(id) {
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(id).classList.add('active-tab');
            if(id === 'admin-tab') loadAdmin();
            if(id === 'game-tab') loadBalance();
        }

        // Create Board
        for (let i = 0; i < 225; i++) {
            let row = Math.floor(i / 15), col = i % 15;
            let d = document.createElement('div'); d.className = 'cell';
            if(row < 6 && col < 6) d.classList.add('red');
            else if(row < 6 && col > 8) d.classList.add('green');
            else if(row > 8 && col < 6) d.classList.add('yellow');
            else if(row > 8 && col > 8) d.classList.add('blue');
            document.getElementById('ludo-board').appendChild(d);
        }

        // Initialize
        loadBalance();
        function rollDice() { document.getElementById('dice-val').innerText = Math.floor(Math.random() * 6) + 1; }
    </script>
</body>
</html>
