<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ludo Cash Online</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        :root { --red: #ff4d4d; --green: #2ecc71; --yellow: #f1c40f; --blue: #3498db; }
        #ludo-board { display: grid; grid-template-columns: repeat(15, 1fr); width: 95vw; height: 95vw; max-width: 400px; max-height: 400px; border: 4px solid #333; margin: auto; }
        .cell { border: 1px solid #eee; background: white; }
        .red { background-color: var(--red); } .green { background-color: var(--green); }
        .yellow { background-color: var(--yellow); } .blue { background-color: var(--blue); }
        .tab-content { display: none; } .active-tab { display: block; }
    </style>
</head>
<body class="bg-gray-100 pb-20">
    <div class="bg-blue-700 text-white p-4 flex justify-between shadow-lg">
        <h1 class="font-bold uppercase tracking-wider text-sm">Ludo Win Pro</h1>
        <div class="text-right"><p class="text-[10px]">‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏</p><p class="font-bold text-yellow-400">‡ß≥ <span id="balance">0</span></p></div>
    </div>

    <!-- PLAY TAB -->
    <div id="game-tab" class="tab-content active-tab p-4 text-center">
        <div id="ludo-board" class="shadow-xl bg-white mb-6 border-8 border-white rounded-lg"></div>
        <button onclick="rollDice()" class="bg-blue-600 text-white px-10 py-3 rounded-full font-bold text-2xl shadow-lg active:scale-95 transition">üé≤ <span id="dice-val">?</span></button>
    </div>

    <!-- WALLET TAB -->
    <div id="wallet-tab" class="tab-content p-4">
        <div class="bg-white p-5 rounded-2xl shadow-xl border border-gray-100">
            <h2 class="font-bold mb-4 text-center text-gray-700">‡¶ü‡¶æ‡¶ï‡¶æ ‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶ø‡¶® (Deposit)</h2>
            <div class="bg-pink-100 p-4 rounded-xl mb-4 text-center border-2 border-dashed border-pink-300">
                <p class="text-xs text-pink-600 mb-1 font-bold">‡¶®‡¶ø‡¶ö‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞‡ßá ‡¶∏‡ßá‡¶®‡ßç‡¶° ‡¶Æ‡¶æ‡¶®‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®:</p>
                <!-- ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ï‡¶æ‡¶∂ ‡¶®‡¶æ‡¶Æ‡ßç‡¶¨‡¶æ‡¶∞ ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶¶‡¶ø‡¶® -->
                <p class="font-black text-2xl text-pink-700">017XXXXXXXX</p> 
            </div>
            <input type="number" id="dep-amount" placeholder="‡¶ü‡¶æ‡¶ï‡¶æ‡¶∞ ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®" class="w-full border p-3 rounded-lg mb-2 focus:ring-2 focus:ring-pink-500 outline-none">
            <input type="text" id="dep-trx" placeholder="Transaction ID (TrxID)" class="w-full border p-3 rounded-lg mb-4 focus:ring-2 focus:ring-pink-500 outline-none">
            <button onclick="submitDeposit()" class="w-full bg-pink-600 text-white py-4 rounded-xl font-bold shadow-lg hover:bg-pink-700 active:scale-95 transition">‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®</button>
        </div>
    </div>

    <!-- ADMIN TAB -->
    <div id="admin-tab" class="tab-content p-4">
        <div class="flex justify-between items-center mb-4">
            <h2 class="font-bold text-red-600 uppercase">‡¶™‡ßá‡¶®‡ßç‡¶°‡¶ø‡¶Ç ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶≤‡¶ø‡¶∏‡ßç‡¶ü</h2>
            <button onclick="logoutAdmin()" class="text-xs bg-gray-200 px-2 py-1 rounded">Logout</button>
        </div>
        <div id="admin-list" class="space-y-3"></div>
    </div>

    <!-- NAV BAR -->
    <div class="fixed bottom-0 w-full bg-white border-t flex justify-around p-4 shadow-[0_-5px_15px_rgba(0,0,0,0.05)] z-50">
        <button onclick="showTab('game-tab')" class="flex flex-col items-center text-blue-600 font-bold"><span class="text-xl">üéÆ</span><span class="text-[10px]">PLAY</span></button>
        <button onclick="showTab('wallet-tab')" class="flex flex-col items-center text-gray-500 font-bold"><span class="text-xl">üí∞</span><span class="text-[10px]">WALLET</span></button>
        <button onclick="showTab('admin-tab')" class="flex flex-col items-center text-gray-400 font-bold"><span class="text-xl">‚öôÔ∏è</span><span class="text-[10px]">ADMIN</span></button>
    </div>

    <script>
        const userId = "shahin_user_1"; // ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡¶á‡¶â‡¶ú‡¶æ‡¶∞‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶≤‡¶æ‡¶¶‡¶æ ‡¶Ü‡¶á‡¶°‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá
        let isAdminAuthenticated = false;

        async function loadBalance() {
            const res = await fetch(`/api/wallet?userId=${userId}`);
            const data = await res.json();
            document.getElementById('balance').innerText = data.balance || 0;
        }

        async function submitDeposit() {
            const amount = document.getElementById('dep-amount').value;
            const trxId = document.getElementById('dep-trx').value;
            if(!amount || !trxId) return alert("‡¶∏‡¶¨ ‡¶§‡¶•‡ßç‡¶Ø ‡¶∏‡¶†‡¶ø‡¶ï‡¶≠‡¶æ‡¶¨‡ßá ‡¶¶‡¶ø‡¶®!");
            
            await fetch('/api/wallet', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type: 'deposit', userId, amount, trxId })
            });
            alert("‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶™‡¶æ‡¶†‡¶æ‡¶®‡ßã ‡¶π‡ßü‡ßá‡¶õ‡ßá! ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶ö‡ßá‡¶ï ‡¶ï‡¶∞‡ßá ‡¶¨‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶®‡ßç‡¶∏ ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßá ‡¶¶‡¶ø‡¶¨‡ßá‡•§");
            document.getElementById('dep-amount').value = '';
            document.getElementById('dep-trx').value = '';
        }

        async function loadAdmin() {
            const res = await fetch('/api/wallet?admin=true');
            const list = await res.json();
            const div = document.getElementById('admin-list');
            if(list.length === 0) div.innerHTML = "<p class='text-center text-gray-400 mt-10'>‡¶ï‡ßã‡¶® ‡¶∞‡¶ø‡¶ï‡ßã‡ßü‡ßá‡¶∏‡ßç‡¶ü ‡¶®‡ßá‡¶á</p>";
            else {
                div.innerHTML = list.map(r => `
                    <div class="bg-white p-4 shadow-md rounded-xl flex justify-between items-center border-l-4 border-green-500">
                        <div><p class="font-bold text-lg text-gray-800">‡ß≥${r.amount}</p><p class="text-xs text-blue-500 font-mono">${r.trxId}</p></div>
                        <button onclick="approve('${r._id}', '${r.userId}', ${r.amount})" class="bg-green-600 text-white px-4 py-2 rounded-lg font-bold text-sm shadow-md active:scale-90 transition">Approve</button>
                    </div>
                `).join('');
            }
        }

        async function approve(id, uId, amt) {
            await fetch('/api/wallet', {
                method: 'POST',
                headers: {'Content-Type': 'application/json'},
                body: JSON.stringify({ type: 'approve', id, userId: uId, amount: amt })
            });
            loadAdmin(); loadBalance();
        }

        function logoutAdmin() {
            isAdminAuthenticated = false;
            showTab('game-tab');
        }

        function showTab(id) {
            if (id === 'admin-tab' && !isAdminAuthenticated) {
                // ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶ö‡ßá‡¶ï
                let pin = prompt("‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶™‡¶ø‡¶® ‡¶ï‡ßã‡¶° ‡¶¶‡¶ø‡¶® (Admin Security PIN):");
                if (pin === "2025") { // ‡¶è‡¶ñ‡¶æ‡¶®‡ßá ‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ ‡¶®‡¶ø‡¶ú‡ßá‡¶∞ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶° ‡¶¶‡¶ø‡¶®
                    isAdminAuthenticated = true;
                } else {
                    alert("‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶æ‡¶∏‡¶ì‡ßü‡¶æ‡¶∞‡ßç‡¶°! ‡¶Ü‡¶™‡¶®‡¶ø ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶°‡¶Æ‡¶ø‡¶® ‡¶®‡¶®‡•§");
                    return;
                }
            }
            
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active-tab'));
            document.getElementById(id).classList.add('active-tab');
            if(id === 'admin-tab') loadAdmin();
            if(id === 'game-tab') loadBalance();
        }

        // ‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶§‡ßà‡¶∞‡¶ø
        const board = document.getElementById('ludo-board');
        for (let i = 0; i < 225; i++) {
            let row = Math.floor(i / 15), col = i % 15;
            let d = document.createElement('div'); d.className = 'cell';
            if(row < 6 && col < 6) d.classList.add('red');
            else if(row < 6 && col > 8) d.classList.add('green');
            else if(row > 8 && col < 6) d.classList.add('yellow');
            else if(row > 8 && col > 8) d.classList.add('blue');
            board.appendChild(d);
        }

        loadBalance();
        function rollDice() { document.getElementById('dice-val').innerText = Math.floor(Math.random() * 6) + 1; }
    </script>
</body>
</html>
